"use strict";(self.webpackChunksamurai_way=self.webpackChunksamurai_way||[]).push([[475],{7475:function(e,s,a){a.r(s),a.d(s,{DialogsContainer:function(){return H}});var i=a(8281),n=a(885),t=a(2791),l="Dialogs_dialogs__gQwrs",o="Dialogs_dialogWindow__mnf2+",r="Dialogs_messagesWindow__Xvse5",c="Dialogs_messages__r0PXH",d="DialogItem_dialogBlock__NRaDx",g="DialogItem_photoBlock__cWJpe",u="DialogItem_userPhoto__TpOKh",m="DialogItem_online__kciUa",h="DialogItem_aboutBlock__+I2WQ",_="DialogItem_about__KwyJj",f="DialogItem_name__KKYjb",j="DialogItem_newMessages__sxz9l",v=a(3504),x=a(1313),D=a(5796),N=function(e){var s=Math.ceil((new Date).getTime()-new Date(e).getTime()),a=Math.ceil(s/1296e4);return a<60?a+" min. ago":a>60&&a<1440?Math.ceil(a/60)+" h ago":a>1440&&a<43200?Math.ceil(a/1440)+" days ago":a>43200&&a<518400?Math.ceil(a/43200)+" months ago":a>518400?new Date(e).toLocaleString("en",{day:"numeric",month:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}):void 0},M=function(e){var s=Math.ceil((new Date).getTime()-new Date(e).getTime());return Math.ceil(s/1296e4)<15},w=a(184),C=t.memo((function(e){var s=e.dialogItem,a=s.id,n=s.photos,t=s.userName,l=s.hasNewMessages,o=s.newMessagesCount,r=s.lastUserActivityDate,c=s.lastDialogActivityDate,C=(0,x.T)(),p="/profile/"+a,I=N(r),T=N(c);return(0,w.jsxs)("div",{className:d,children:[(0,w.jsxs)("div",{onClick:function(){C((0,i.AH)(a))},className:g,children:[(0,w.jsx)("img",{className:u,src:null!=n.small?n.small:D,alt:"avatar"}),M(r)&&(0,w.jsx)("div",{className:m})]}),(0,w.jsxs)("div",{className:h,children:[(0,w.jsxs)("div",{className:_,children:[(0,w.jsx)(v.OL,{to:p,title:"see profile",children:(0,w.jsx)("h5",{className:f,children:t})}),(0,w.jsxs)("h6",{children:["Last: ",(0,w.jsx)("span",{children:I})]}),(0,w.jsxs)("h6",{children:["Dialog: ",(0,w.jsx)("span",{children:T})]})]}),(0,w.jsxs)("div",{className:j,children:[" ",l?(0,w.jsxs)("span",{style:{color:"limegreen"},children:["New ",o," messages"]}):""]})]})]})})),p={messageBlock:"Message_messageBlock__tr-dI",nameData:"Message_nameData__+Dz7a",name:"Message_name__Rq0ss",dateAdd:"Message_dateAdd__aGmR+",message:"Message_message__YdCvZ",left:"Message_left__Cejf-",right:"Message_right__PleNH"},I=function(e){var s=e.message,a=e.userId,i=s.senderId===a?p.right:p.left;return(0,w.jsxs)("div",{className:"".concat(p.messageBlock," ").concat(i),children:[(0,w.jsxs)("div",{className:p.nameData,children:[(0,w.jsx)("h5",{className:p.name,children:s.senderName}),(0,w.jsx)("span",{className:p.dateAdd,children:N(s.addedAt)})]}),(0,w.jsx)("div",{className:p.body,children:(0,w.jsx)("p",{className:p.message,children:s.body})})]},s.id)},T=a(2811),k=a(6509),y="SendMessage_sendMessage__rjtdj",P="SendMessage_buttonBlock__8ndoV",b=function(e){var s=e.userId,a=(0,x.C)((function(e){return e.dialogsPage.isFetching})),l=(0,t.useState)(""),o=(0,n.Z)(l,2),r=o[0],c=o[1],d=(0,x.T)();console.log("SendMessageForm",s);return(0,w.jsxs)("div",{className:y,children:[(0,w.jsx)("div",{children:(0,w.jsx)(T.iF,{onChange:function(e){return c(e.currentTarget.value)},value:r})}),(0,w.jsx)("div",{className:P,children:(0,w.jsx)(k.z,{disabled:a,onClick:function(){r&&(d((0,i.CJ)(s,r)),c(""))},children:"Send"})})]})},A=t.memo((function(e){var s=(0,x.T)(),a=(0,x.C)((function(e){return e.dialogsPage.dialogs})),d=(0,x.C)((function(e){return e.dialogsPage.messages})),g=(0,x.C)((function(e){return e.dialogsPage.userId})),u=(0,x.C)((function(e){return e.dialogsPage.totalCount})),m=(0,t.useState)(!0),h=(0,n.Z)(m,2),_=h[0],f=h[1],j=(0,t.useState)(1),v=(0,n.Z)(j,2),D=v[0],N=v[1],M=(0,t.useRef)(null),p=(0,t.useRef)(null);return(0,t.useEffect)((function(){var e;_&&(null===(e=p.current)||void 0===e||e.scrollIntoView({behavior:"smooth"}))}),[d,_]),(0,t.useEffect)((function(){s((0,i.UP)())}),[s,g]),(0,w.jsxs)("div",{className:l,children:[(0,w.jsx)("div",{style:{height:"650px",overflowY:"auto"},className:o,children:a&&a.map((function(e){return(0,w.jsx)(C,{dialogItem:e},e.id)}))}),(0,w.jsxs)("div",{className:r,children:[(0,w.jsxs)("div",{style:{height:"480px",overflowY:"auto"},className:c,onScroll:function(e){var s=e.currentTarget;s.scrollHeight-s.scrollTop===s.clientHeight?(!_&&f(!0),N(D-1)):_&&f(!1),s.scrollTop<0&&u>10*D&&N(D+1)},children:[(0,w.jsx)("div",{ref:M}),d&&d.map((function(e){return(0,w.jsx)(I,{message:e,userId:g},e.id)})),(0,w.jsx)("div",{ref:p})]}),(0,w.jsx)(b,{userId:g})]})]})})),S=a(2177),B=a(2163),H=(0,a(7781).qC)((0,S.$j)((function(e){return{dialogsPage:e.dialogsPage.dialogs,isAuth:e.auth.isAuth}}),{newTextMessageOnChange:i.Hw,sendMessageTC:i.CJ,getDialogsTC:i.UP}),B.e)(A)}}]);
//# sourceMappingURL=475.31dc3d19.chunk.js.map