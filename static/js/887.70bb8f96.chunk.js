"use strict";(self.webpackChunksamurai_way=self.webpackChunksamurai_way||[]).push([[887],{887:function(e,s,a){a.r(s),a.d(s,{DialogsContainer:function(){return H}});var n=a(8281),t=a(3430),i=a(2791),l="Dialogs_dialogs__gQwrs",o="Dialogs_dialogWindow__mnf2+",r="Dialogs_messagesWindow__Xvse5",c="Dialogs_messages__r0PXH",d="DialogItem_dialogBlock__NRaDx",g="DialogItem_photoBlock__cWJpe",u="DialogItem_userPhoto__TpOKh",m="DialogItem_online__kciUa",h="DialogItem_aboutBlock__+I2WQ",_="DialogItem_about__KwyJj",f="DialogItem_name__KKYjb",v="DialogItem_newMessages__sxz9l",j=a(3504),x=a(1313),D=a(5796);function N(e){var s=new Date,a=new Date(e),n=s.getTime()-a.getTime(),t=36e5,i=864e5,l=30*i;if(n<t){var o=Math.floor(n/6e4);return"".concat(o," min. ago")}if(n<i){var r=Math.floor(n/t);return"".concat(r," hours ago")}if(n<l){var c=Math.floor(n/i);return"".concat(c," days ago")}if(n<31536e6){var d=Math.floor(n/l);return"".concat(d," months ago")}var g=a.getDate(),u=a.getMonth()+1,m=a.getFullYear();return"".concat(g<10?"0":"").concat(g,".").concat(u<10?"0":"").concat(u,".").concat(m)}var M=function(e){var s=Math.ceil((new Date).getTime()-new Date(e).getTime());return Math.ceil(s/1e6)<15},w=a(184),C=i.memo((function(e){var s=e.dialogItem,a=s.id,t=s.photos,i=s.userName,l=s.hasNewMessages,o=s.newMessagesCount,r=s.lastUserActivityDate,c=s.lastDialogActivityDate,C=(0,x.T)(),p="/profile/"+a,I=N(r),T=N(c);Math.ceil(new Date(c).getTime());return(0,w.jsxs)("div",{className:d,children:[(0,w.jsxs)("div",{onClick:function(){C((0,n.AH)(a))},className:g,children:[(0,w.jsx)("img",{className:u,src:null!=t.small?t.small:D,alt:"avatar"}),M(r)&&(0,w.jsx)("div",{className:m})]}),(0,w.jsxs)("div",{className:h,children:[(0,w.jsxs)("div",{className:_,children:[(0,w.jsx)(j.OL,{to:p,title:"see profile",children:(0,w.jsx)("h5",{className:f,children:i})}),(0,w.jsxs)("h6",{children:["Last: ",(0,w.jsx)("span",{children:I})]}),(0,w.jsxs)("h6",{children:["Dialog: ",(0,w.jsx)("span",{children:T})]})]}),(0,w.jsxs)("div",{className:v,children:[" ",l?(0,w.jsxs)("span",{style:{color:"limegreen"},children:["New ",o," messages"]}):""]})]})]})})),p={messageBlock:"Message_messageBlock__tr-dI",nameData:"Message_nameData__+Dz7a",name:"Message_name__Rq0ss",dateAdd:"Message_dateAdd__aGmR+",message:"Message_message__YdCvZ",left:"Message_left__Cejf-",right:"Message_right__PleNH"},I=function(e){var s=e.message,a=e.userId,n=s.senderId===a?p.right:p.left;return(0,w.jsxs)("div",{className:"".concat(p.messageBlock," ").concat(n),children:[(0,w.jsxs)("div",{className:p.nameData,children:[(0,w.jsx)("h5",{className:p.name,children:s.senderName}),(0,w.jsx)("span",{className:p.dateAdd,children:N(s.addedAt)})]}),(0,w.jsx)("div",{className:p.body,children:(0,w.jsx)("p",{className:p.message,children:s.body})})]},s.id)},T=a(8298),k=a(8606),P="SendMessage_sendMessage__rjtdj",y="SendMessage_buttonBlock__8ndoV",b=function(e){var s=e.userId,a=(0,x.C)((function(e){return e.dialogsPage.isFetching})),l=(0,i.useState)(""),o=(0,t.Z)(l,2),r=o[0],c=o[1],d=(0,x.T)();return(0,w.jsxs)("div",{className:P,children:[(0,w.jsx)("div",{children:(0,w.jsx)(T.iF,{onChange:function(e){return c(e.currentTarget.value)},value:r})}),(0,w.jsx)("div",{className:y,children:(0,w.jsx)(k.z,{disabled:a,onClick:function(){r&&(d((0,n.CJ)(s,r)),c(""))},children:"Send"})})]})},A=i.memo((function(e){var s=(0,x.T)(),a=(0,x.C)((function(e){return e.dialogsPage.dialogs})),d=(0,x.C)((function(e){return e.dialogsPage.messages})),g=(0,x.C)((function(e){return e.dialogsPage.userId})),u=(0,x.C)((function(e){return e.dialogsPage.totalCount})),m=(0,i.useState)(!0),h=(0,t.Z)(m,2),_=h[0],f=h[1],v=(0,i.useState)(1),j=(0,t.Z)(v,2),D=j[0],N=j[1],M=(0,i.useRef)(null),p=(0,i.useRef)(null);return(0,i.useEffect)((function(){var e;_&&(null===(e=p.current)||void 0===e||e.scrollIntoView({behavior:"smooth"}))}),[d,_]),(0,i.useEffect)((function(){s((0,n.UP)())}),[s,g]),(0,w.jsxs)("div",{className:l,children:[(0,w.jsx)("div",{style:{height:"650px",overflowY:"auto"},className:o,children:a&&a.map((function(e){return(0,w.jsx)(C,{dialogItem:e},e.id)}))}),(0,w.jsxs)("div",{className:r,children:[(0,w.jsxs)("div",{style:{height:"480px",overflowY:"auto"},className:c,onScroll:function(e){var s=e.currentTarget;s.scrollTop<=0&&u>10*D&&N(D+1),s.scrollHeight-s.scrollTop===s.clientHeight?!_&&f(!0):_&&f(!1)},children:[(0,w.jsx)("div",{ref:M}),d&&d.map((function(e){return(0,w.jsx)(I,{message:e,userId:g},e.id)})),(0,w.jsx)("div",{ref:p})]}),(0,w.jsx)(b,{userId:g})]})]})})),B=a(2177),S=a(2163),H=(0,a(1666).qC)((0,B.$j)((function(e){return{dialogsPage:e.dialogsPage.dialogs,isAuth:e.auth.isAuth}}),{newTextMessageOnChange:n.Hw,sendMessageTC:n.CJ,getDialogsTC:n.UP}),S.e)(A)}}]);
//# sourceMappingURL=887.70bb8f96.chunk.js.map